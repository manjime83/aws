AWSTemplateFormatVersion: "2010-09-09"

Parameters:
  ProjectName:
    Type: String
    Default: mipaquete
  EnvType:
    Type: String
    Default: test
    AllowedValues:
      - prod
      - test
  Domain:
    Type: String
    Default: mipaquete.transadmin.co

Resources:
  vpc:
    Type: AWS::CloudFormation::Stack
    Properties:
      Parameters:
        ProjectName: !Ref ProjectName
        EnvType: !Ref EnvType
      TemplateURL: stacks/vpc.yaml

  app:
    Type: AWS::CloudFormation::Stack
    Properties:
      Parameters:
        ProjectName: !Ref ProjectName
        EnvType: !Ref EnvType
        Domain: !Ref Domain
      TemplateURL: stacks/app.yaml

  api:
    Type: AWS::CloudFormation::Stack
    Properties:
      Parameters:
        ProjectName: !Ref ProjectName
        EnvType: !Ref EnvType
        Domain: !Ref Domain
        OperatorsGroup: !GetAtt app.Outputs.OperatorsGroup
        VPC: !GetAtt vpc.Outputs.VPC
        PublicSubnets: !GetAtt vpc.Outputs.PublicSubnets
      TemplateURL: stacks/api.yaml

Outputs:
  VPC:
    Value: !GetAtt vpc.Outputs.VPC
  PublicSubnets:
    Value: !GetAtt vpc.Outputs.PublicSubnets
  DistributionId:
    Value: !GetAtt app.Outputs.DistributionId
  WebsiteURL:
    Value: !GetAtt app.Outputs.WebsiteURL
